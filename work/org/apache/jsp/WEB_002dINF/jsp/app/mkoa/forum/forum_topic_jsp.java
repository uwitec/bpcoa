/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/7.0.34
 * Generated at: 2013-02-20 04:07:08 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.WEB_002dINF.jsp.app.mkoa.forum;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import com.mixky.engine.organization.User;
import com.mixky.app.certification.MixkyUserCertification;
import com.mixky.app.mkoa.forum.ForumManager;

public final class forum_topic_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private javax.el.ExpressionFactory _el_expressionfactory;
  private org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public void _jspInit() {
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=utf-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");

	String panelid = request.getParameter("panelid");
	User user = MixkyUserCertification.instance().getUserInfo(request);
	
	String clientIp = request.getRemoteAddr();

      out.write("\r\n");
      out.write("\r\n");
      out.write("<script language='javascript'>\r\n");
      out.write("\r\n");
      out.write("Ext.onReady(function(){\r\n");
      out.write("\r\n");
      out.write("\tvar panel = Ext.getCmp('");
      out.print(panelid);
      out.write("');\r\n");
      out.write("\r\n");
      out.write("\t// 数据访问\r\n");
      out.write("\tvar store = new Ext.data.DirectStore({\r\n");
      out.write("\t\tdirectFn : AppForumDirect.getTopicList,\r\n");
      out.write("\t\tparamOrder:['topicId', 'state','limit','start'],\r\n");
      out.write("\t\tbaseParams:{topicId:0, state:0, limit:50, start:0},\r\n");
      out.write("\t\troot : 'results',\r\n");
      out.write("\t\ttotalProperty : 'totals',\r\n");
      out.write("\t\tidProperty : 'ID',\r\n");
      out.write("\t\tfields:[\"ID\",\"F_TITLE\",\"F_AUTHOR_TITLE\",\"F_CREATED\",\"F_UPDATER\",\"F_UPDATED\",\"F_CONTENT\",\"F_POSITION\",\"F_STATE\", \"F_SUBJECT_TYPE\", \"F_FILES\"]\r\n");
      out.write("\t});\r\n");
      out.write("\r\n");
      out.write("\tvar sm = new Ext.grid.RowSelectionModel({singleSelect:true});\r\n");
      out.write("\r\n");
      out.write("\t// 视图按钮\r\n");
      out.write("\tvar buttons = [];\r\n");
      out.write("\r\n");
      out.write("\tbuttons.push({\r\n");
      out.write("\t\txtype: 'tbtext',\r\n");
      out.write("\t\ttext: '<a href=\"#\" onclick=\"Ext.getCmp(\\'");
      out.print(panelid);
      out.write("\\').openAll()\">论坛列表</a> >>'\r\n");
      out.write("\t});\r\n");
      out.write("\tvar catagoryText = new Ext.Toolbar.TextItem({\r\n");
      out.write("\t\ttext: ''\r\n");
      out.write("\t});\r\n");
      out.write("\tbuttons.push(catagoryText);\r\n");
      out.write("\tbuttons.push({xtype: 'tbtext', text: ' >> '});\r\n");
      out.write("\tvar subjectText = new Ext.Toolbar.TextItem({\r\n");
      out.write("\t\ttext: ''\r\n");
      out.write("\t});\r\n");
      out.write("\tbuttons.push(subjectText);\r\n");
      out.write("\t\r\n");
      out.write("\r\n");
      out.write("\tbuttons.push('->');\r\n");
      out.write("\t\r\n");
      out.write("\t// 输出视图操作\r\n");
      out.write("\r\n");
      out.write("\tvar btnReplyTopic = new Ext.Action({\r\n");
      out.write("\t\ttext : '回复话题',\r\n");
      out.write("\t\ticonCls : 'icon-app-mkoa-forum-replay',\r\n");
      out.write("\t\tisDefault : false,\r\n");
      out.write("\t\thandler : function () {panel.replySubject();}\r\n");
      out.write("\t});\r\n");
      out.write("\tbuttons.push(btnReplyTopic);\r\n");
      out.write("\r\n");
      out.write("\tvar btnFW = new Ext.Action({\r\n");
      out.write("\t\ttext : '转到知识库',\r\n");
      out.write("\t\ticonCls : 'icon-sys-refresh',\r\n");
      out.write("\t\thandler : function(){\r\n");
      out.write("\t\t\tAppForumDirect.getForumSubjectJsonObj(store.baseParams.topicId + '', function(result, event) {\r\n");
      out.write("\t\t\t\tvar fcontent = result.f_content + '<br/><a href=# class=\"x-forum-fwto-knowledge\" topicId=' + store.baseParams.topicId \r\n");
      out.write("\t\t\t\t+ ' state=\"' + store.baseParams.state + '\" forumTitle=\"' + result.f_title + '\" forumId=' + result.f_forum_Id + ' >来源于电子论坛，点击此处查看原贴<a/>'\r\n");
      out.write("\t\t\t\tMixkyApp.desktop.openDocument('mkKnowledge.docKnowledgeDetail', 0, {F_TITLE: result.f_title, F_CONTENT:fcontent});\r\n");
      out.write("\t\t\t});\r\n");
      out.write("\t\t}\r\n");
      out.write("\t});\r\n");
      out.write("\tbuttons.push(btnFW);\r\n");
      out.write("\r\n");
      out.write("\tif (panel.initParams.state > 0) {\t\r\n");
      out.write("\t\tbuttons.push('-');\r\n");
      out.write("\t\tvar btnOpenTopic = new Ext.Action({\r\n");
      out.write("\t\t\ttext : '开启话题',\r\n");
      out.write("\t\t\ticonCls : 'icon-app-mkoa-forum-unlock',\r\n");
      out.write("\t\t\tisDefault : false,\r\n");
      out.write("\t\t\thandler : function () {panel.openClosedSubject();}\r\n");
      out.write("\t\t});\r\n");
      out.write("\t\t//buttons.push(btnOpenTopic);\r\n");
      out.write("\t\t\r\n");
      out.write("\t\tvar btnCloseTopic = new Ext.Action({\r\n");
      out.write("\t\t\ttext : '关闭话题',\r\n");
      out.write("\t\t\ticonCls : 'icon-app-mkoa-forum-lock',\r\n");
      out.write("\t\t\tisDefault : false,\r\n");
      out.write("\t\t\thandler : function () {panel.closeSubject();}\r\n");
      out.write("\t\t});\r\n");
      out.write("\t\tbuttons.push(btnCloseTopic);\r\n");
      out.write("\t\r\n");
      out.write("\t\tvar btnSetTop = new Ext.Action({\r\n");
      out.write("\t\t\ttext : '话题置顶',\r\n");
      out.write("\t\t\ticonCls : 'icon-app-mkoa-forum-top',\r\n");
      out.write("\t\t\tisDefault : false,\r\n");
      out.write("\t\t\thandler : function () {panel.topSubject(1);}\r\n");
      out.write("\t\t});\r\n");
      out.write("\t\tbuttons.push(btnSetTop);\r\n");
      out.write("\t\r\n");
      out.write("\t\tvar btnSetFavourate = new Ext.Action({\r\n");
      out.write("\t\t\ttext : '设为精华',\r\n");
      out.write("\t\t\ticonCls : 'icon-app-mkoa-forum-classical',\r\n");
      out.write("\t\t\tisDefault : false,\r\n");
      out.write("\t\t\thandler : function () {panel.favouriteSubject(1);}\r\n");
      out.write("\t\t});\r\n");
      out.write("\t\tbuttons.push(btnSetFavourate);\r\n");
      out.write("\t}\r\n");
      out.write("\r\n");
      out.write("\t// 刷新按钮\r\n");
      out.write("\tvar btnRefresh = new Ext.Action({\r\n");
      out.write("\t\ttext : '刷新',\r\n");
      out.write("\t\ticonCls : 'icon-sys-refresh',\r\n");
      out.write("\t\thandler : function(){\r\n");
      out.write("\t\t\tpanel.refresh();\r\n");
      out.write("\t\t}\r\n");
      out.write("\t});\r\n");
      out.write("\tbuttons.push('-');\r\n");
      out.write("\tbuttons.push(btnRefresh);\r\n");
      out.write("\r\n");
      out.write("\t// 渲染主题\r\n");
      out.write("\tvar rdAuthor = function(value, p, r){\r\n");
      out.write("        return String.format(\r\n");
      out.write("                '<div style=\"padding-left:0px;background:transparent) no-repeat 0 2px;\"><br/>'\r\n");
      out.write("                 + '<span style=\"color:#333;font-size:10px;\">{0}</span><br/>' \r\n");
      out.write("                 + '<span style=\"color:#333;font-size:10px;\">{1}</span><br/>'\r\n");
      out.write("                 + '<br/><span style=\"color:#333;font-size:10px;\">{2}</span></div>',\r\n");
      out.write("                r.data['F_AUTHOR_TITLE'],\r\n");
      out.write("                r.data['F_CREATED'],\r\n");
      out.write("\t\t\t\tr.data['F_POSITION']);\r\n");
      out.write("    };\r\n");
      out.write("\t// 渲染辅助信息\r\n");
      out.write("\tvar rdContent = function(value, p, r){\r\n");
      out.write("\t\t return String.format(\r\n");
      out.write("                '<div style=\"padding-left:0px;background:transparent no-repeat 0 2px;\"><b style=\"display:block;color:#333;font-size:15px;\">{0}</b><hr><span style=\"color:#333;\">{1}</span>',\r\n");
      out.write("                r.data['F_TITLE'],\r\n");
      out.write("\t\t\t\tr.data['F_CONTENT']);\r\n");
      out.write("    };\r\n");
      out.write("\t\r\n");
      out.write("\t// 显示列\r\n");
      out.write("\tvar cm = new Ext.grid.ColumnModel([{\r\n");
      out.write("\t     header: \"作者\",\r\n");
      out.write("\t     dataIndex: 'F_AUHTOR',\r\n");
      out.write("\t     width: 120,\r\n");
      out.write("\t     align: 'center',\r\n");
      out.write("\t     renderer: rdAuthor\r\n");
      out.write("\t },{\r\n");
      out.write("\t\t id: \"topic\",\r\n");
      out.write("\t     header: \"内容\",\r\n");
      out.write("\t     dataIndex: 'F_CONTENT',\r\n");
      out.write("\t     align: 'left',\r\n");
      out.write("\t     renderer: rdContent\r\n");
      out.write("    }]);\r\n");
      out.write("\r\n");
      out.write("\tvar tpl;\r\n");
      out.write("\tif (panel.initParams.state > 0) {\r\n");
      out.write("\t\ttpl = new Ext.XTemplate(\r\n");
      out.write("\t\t\t'<tpl for=\".\">',\r\n");
      out.write("\t\t\t\t'<tpl if=\"F_STATE!=0\">',\r\n");
      out.write("\t\t\t\t\t'<strike>',\r\n");
      out.write("\t\t\t\t'</tpl>',\r\n");
      out.write("\t\t\t\t'<div class=\"x-forum-thread-detail\">',\r\n");
      out.write("\t\t\t\t\t'<div class=\"x-forum-thread-inner\">',\r\n");
      out.write("\t\t\t\t\t\t'<div class=\"x-forum-thread-header\">',\r\n");
      out.write("\t\t\t\t\t\t\t'<table width=\"100%\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t'<tr>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t'<td>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t'<div class=\"x-forum-thread-header-info\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t\t'<b>&nbsp;# {F_POSITION}</b>&nbsp;&nbsp;{F_AUTHOR_TITLE}({F_CREATED})',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t'</div>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t'</td>',\r\n");
      out.write("\t\t\t\t\t\t\t\t'</tr>',\r\n");
      out.write("\t\t\t\t\t\t\t'</table>',\r\n");
      out.write("\t\t\t\t\t\t'</div>',\r\n");
      out.write("\t\t\t\t\t\t\t'<div class=\"x-forum-thread-body\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t'<div class=\"x-forum-thread-body-inner\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t'<div class=\"x-forum-thread-author\"><b>{F_TITLE}&nbsp;&nbsp;{F_SUBJECT_TYPE}</b></div>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t'<div class=\"x-forum-thread-desc\">{F_CONTENT}</div>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t'<tpl for=\"F_FILES\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t'<tpl if=\"ISIMAGE==1\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t\tExt.isIE ? '' : '<img src=\"{[this.getImageUrl(values.ID, values.F_NAME)]}\" class=\"mixky-detail-image\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t\t'<div class=\"x-forum-thread-attach\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t\t\t'<img class=\"function-file-download\" src=\"resources/images/app/forum/attach.png\" style=\"cursor:pointer\"><a class=\"x-forum-thread-attach-link\" href=\"#\" onclick=\"javascript:Ext.getCmp(\\'");
      out.print(panelid);
      out.write("\\').downloadFile({ID});\"><b>{F_NAME}</b></a>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t\t'</div>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t\t'<br>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t'</tpl>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t'</tpl>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t'<tpl for=\"F_FILES\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t'<tpl if=\"ISIMAGE==0\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t\t'<div class=\"x-forum-thread-attach\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t\t\t'<img class=\"function-file-download\" src=\"resources/images/app/forum/attach.png\" style=\"cursor:pointer\"><a class=\"x-forum-thread-attach-link\" href=\"#\" onclick=\"javascript:Ext.getCmp(\\'");
      out.print(panelid);
      out.write("\\').downloadFile({ID});\"><b>{F_NAME}</b></a>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t\t'</div>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t'</tpl>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t'</tpl>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t'<div class=\"x-forum-thread-footer\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t'<tpl if=\"F_POSITION!=1\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t'<tpl if=\"F_STATE==0\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t\t'<input class=\"x-forum-thread-footer-close\" type=\"button\" value=\"关闭回复\" />',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t'</tpl>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t'<tpl if=\"F_STATE!=0\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t\t'<input class=\"x-forum-thread-footer-open\" type=\"button\" value=\"开启回复\" />',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t'</tpl>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t'</tpl>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t'<tpl if=\"F_AUTHOR_TITLE == \\'");
      out.print(user.getF_caption());
      out.write("\\'\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t'<tpl if=\"F_POSITION==1\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t\t'<input class=\"x-forum-thread-footer-edit\" type=\"button\" value=\"编辑\" />',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t'</tpl>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t'</tpl>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t'<input class=\"x-forum-thread-footer-quote\" type=\"button\" value=\"引用\" />',\r\n");
      out.write("\t\t\t\t\t\t\t\t'</div>',\r\n");
      out.write("\t\t\t\t\t\t\t'</div>',\r\n");
      out.write("\t\t\t\t\t\t'</div>',\r\n");
      out.write("\t\t\t\t\t'</div>',\r\n");
      out.write("\t\t\t\t'</div>',\r\n");
      out.write("\t\t\t\t'<tpl if=\"F_STATE!=0\">',\r\n");
      out.write("\t\t\t\t\t'</strike>',\r\n");
      out.write("\t\t\t\t'</tpl>',\r\n");
      out.write("\t\t\t'</tpl>',\r\n");
      out.write("\t\t\t'<div class=\"x-clear\"></div>',\r\n");
      out.write("\t\t    {\r\n");
      out.write("\t\t        compiled: true,\r\n");
      out.write("\t\t        getImageUrl: function(id, name){\r\n");
      out.write("\t\t            return 'engine/file/sysdownload.do?tablename=T_MK_SYS_FILES&fieldname=F_CONTENT&id=' + id + '&filename=' + name;\r\n");
      out.write("\t\t        }\r\n");
      out.write("\t\t    }\r\n");
      out.write("\t\t);\r\n");
      out.write("\t}else{\r\n");
      out.write("\t\ttpl = new Ext.XTemplate(\r\n");
      out.write("\t\t\t'<tpl for=\".\">',\r\n");
      out.write("\t\t\t\t'<div class=\"x-forum-thread-detail\">',\r\n");
      out.write("\t\t\t\t\t'<div class=\"x-forum-thread-inner\">',\r\n");
      out.write("\t\t\t\t\t\t'<div class=\"x-forum-thread-header\">',\r\n");
      out.write("\t\t\t\t\t\t\t'<table width=\"100%\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t'<tr>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t'<td>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t'<div class=\"x-forum-thread-header-info\"><b>&nbsp;# {F_POSITION}</b>&nbsp;&nbsp;{F_AUTHOR_TITLE}({F_CREATED})</div>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t'</td>',\r\n");
      out.write("\t\t\t\t\t\t\t\t'</tr>',\r\n");
      out.write("\t\t\t\t\t\t\t'</table>',\r\n");
      out.write("\t\t\t\t\t\t'</div>',\r\n");
      out.write("\t\t\t\t\t\t'<div class=\"x-forum-thread-body\">',\r\n");
      out.write("\t\t\t\t\t\t\t'<div class=\"x-forum-thread-body-inner\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t'<div class=\"x-forum-thread-author\"><b>{F_TITLE}</b>&nbsp;&nbsp;{F_SUBJECT_TYPE}</div>',\r\n");
      out.write("\t\t\t\t\t\t\t\t'<div class=\"x-forum-thread-desc\">{F_CONTENT}</div>',\r\n");
      out.write("\t\t\t\t\t\t\t\t'<tpl for=\"F_FILES\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t'<tpl if=\"ISIMAGE==1\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\tExt.isIE ? '' : '<img src=\"{[this.getImageUrl(values.ID, values.F_NAME)]}\" class=\"mixky-detail-image\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t'<div class=\"x-forum-thread-attach\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t\t'<img class=\"function-file-download\" src=\"resources/images/app/forum/attach.png\" style=\"cursor:pointer\"><a class=\"x-forum-thread-attach-link\" href=\"#\" onclick=\"javascript:Ext.getCmp(\\'");
      out.print(panelid);
      out.write("\\').downloadFile({ID});\"><b>{F_NAME}</b></a>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t'</div>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t'<br>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t'</tpl>',\r\n");
      out.write("\t\t\t\t\t\t\t\t'</tpl>',\r\n");
      out.write("\t\t\t\t\t\t\t\t'<tpl for=\"F_FILES\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t'<tpl if=\"ISIMAGE==0\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t'<div class=\"x-forum-thread-attach\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t\t'<img class=\"function-file-download\" src=\"resources/images/app/forum/attach.png\" style=\"cursor:pointer\"><a class=\"x-forum-thread-attach-link\" href=\"#\" onclick=\"javascript:Ext.getCmp(\\'");
      out.print(panelid);
      out.write("\\').downloadFile({ID});\"><b>{F_NAME}</b></a>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t'</div>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t'</tpl>',\r\n");
      out.write("\t\t\t\t\t\t\t\t'</tpl>',\r\n");
      out.write("\t\t\t\t\t\t\t\t'<div class=\"x-forum-thread-footer\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t'<input class=\"x-forum-thread-footer-quote\" type=\"button\" value=\"引用\" />',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t'<tpl if=\"F_AUTHOR_TITLE == \\'");
      out.print(user.getF_caption());
      out.write("\\'\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t'<tpl if=\"F_POSITION==1\">',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t\t'<input class=\"x-forum-thread-footer-edit\" type=\"button\" value=\"编辑\" />',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t'</tpl>',\r\n");
      out.write("\t\t\t\t\t\t\t\t\t'</tpl>',\r\n");
      out.write("\t\t\t\t\t\t\t\t'</div>',\r\n");
      out.write("\t\t\t\t\t\t\t'</div>',\r\n");
      out.write("\t\t\t\t\t\t'</div>',\r\n");
      out.write("\t\t\t\t\t'</div>',\r\n");
      out.write("\t\t\t\t'</div>',\r\n");
      out.write("\t\t\t'</tpl>',\r\n");
      out.write("\t\t\t'<div class=\"x-clear\"></div>',\r\n");
      out.write("\t\t    {\r\n");
      out.write("\t\t        compiled: true,\r\n");
      out.write("\t\t        getImageUrl: function(id, name){\r\n");
      out.write("\t\t            return 'engine/file/sysdownload.do?tablename=T_MK_SYS_FILES&fieldname=F_CONTENT&id=' + id + '&filename=' + name;\r\n");
      out.write("\t\t        }\r\n");
      out.write("\t\t    }\r\n");
      out.write("\t\t);\r\n");
      out.write("\t}\r\n");
      out.write("\tvar dataView=new Ext.DataView({\r\n");
      out.write("\t\tstore:store,\r\n");
      out.write("\t\ttpl:tpl,\r\n");
      out.write("\t\titemSelector:\"div.x-forum-thread-detail\",\r\n");
      out.write("\t\tsingleSelect:true\r\n");
      out.write("\t});\r\n");
      out.write("\tdataView.on(\"click\",function(dv,index,node,e){\r\n");
      out.write("\t\tvar tgEl = Ext.get(e.getTarget());\r\n");
      out.write("\t\tvar rd = store.getAt(index);\r\n");
      out.write("\t\tif(tgEl.hasClass(\"x-forum-thread-footer-quote\")){\r\n");
      out.write("\t\t\tvar author=rd.data.F_AUTHOR_TITLE;\r\n");
      out.write("\t\t\tvar desc=rd.data.F_CONTENT;\r\n");
      out.write("\t\t\tvar rContent = '<br><div style=\"padding:10px 20px 10px 20px;\"><b style=\"font-size:14px;\">引用:</b>' \r\n");
      out.write("\t\t\t\t\t\t\t+ '<div style=\"border:1px solid silver;padding:5px;background:rgb(239,239,239);\">' \r\n");
      out.write("\t\t\t\t\t\t\t+ '<b style=\"font-size:12px;\">Originally Posted by '+author+\"</b><br><br>\"+desc+\"</div></div><br><br>\";\r\n");
      out.write("\t\t\tvar id = panel.params.topicId;\r\n");
      out.write("\t\t\tvar title = \"回复: \" + panel.params.topicTitle;\r\n");
      out.write("\t\t\tMixkyApp.desktop.openDocument('mkForum.docReSubject', 0, {F_CONTENT:rContent, F_FORUM_ID:panel.initParams.forumId, F_REPLY_SUBJECT_ID:id, F_TITLE:title, F_REMOTE_HOST:\"");
      out.print(clientIp);
      out.write("\"});\r\n");
      out.write("\t\t} else if (tgEl.hasClass(\"x-forum-thread-footer-close\")) {\r\n");
      out.write("\t\t\tvar tgEl = Ext.get(e.getTarget());\r\n");
      out.write("\t\t\tvar rd = store.getAt(index);\r\n");
      out.write("\t\t\tAppForumDirect.closeSubject(rd.get(\"ID\") + '');\r\n");
      out.write("\t\t\tpanel.refresh();\r\n");
      out.write("\t\t} else if (tgEl.hasClass(\"x-forum-thread-footer-open\")) {\r\n");
      out.write("\t\t\tvar tgEl = Ext.get(e.getTarget());\r\n");
      out.write("\t\t\tvar rd = store.getAt(index);\r\n");
      out.write("\t\t\tAppForumDirect.openSubject(rd.get(\"ID\") + '');\r\n");
      out.write("\t\t\tpanel.refresh();\r\n");
      out.write("\t\t} else if (tgEl.hasClass(\"x-forum-thread-footer-edit\")) {\r\n");
      out.write("\t\t\tMixkyApp.desktop.openDocument('mkForum.docSubject', panel.params.topicId, {});\r\n");
      out.write("\t\t}\r\n");
      out.write("\t},this);\r\n");
      out.write("\r\n");
      out.write("\tvar pagebar = new Ext.PagingToolbar({\r\n");
      out.write("    \tfirstText : '首页',\r\n");
      out.write("    \tlastText : '尾页',\r\n");
      out.write("    \tnextText : '下一页',\r\n");
      out.write("    \tprevText : '上一页',\r\n");
      out.write("    \trefreshText : '刷新',\r\n");
      out.write("    \tbeforePageText : '第',\r\n");
      out.write("    \tafterPageText : '页，共 {0} 页',\r\n");
      out.write("    \tdisplayMsg : '共 {2} 条，当前显示 {0} 到 {1} 条',\r\n");
      out.write("    \temptyMsg : '没有符合条件的主题',\r\n");
      out.write("        pageSize: 50,\r\n");
      out.write("        store: store,\r\n");
      out.write("        displayInfo: true,\r\n");
      out.write("        items : [\r\n");
      out.write("            '-',\r\n");
      out.write("            '每页显示:',\r\n");
      out.write("            new Ext.form.ComboBox({\r\n");
      out.write("                editable : false,\r\n");
      out.write("                triggerAction: 'all',\r\n");
      out.write("                width : 50,\r\n");
      out.write("           \t\tstore : [10, 20, 30, 50, 100, 200],\r\n");
      out.write("           \t\tvalue : 50,\r\n");
      out.write("           \t\tlisteners : {\r\n");
      out.write("           \t\t\t'select' : function(c, record, index){\r\n");
      out.write("            \t\t\tpagebar.pageSize = c.getValue();\r\n");
      out.write("            \t\t\tpagebar.changePage(1);\r\n");
      out.write("           \t\t\t}\r\n");
      out.write("               \t}\r\n");
      out.write("       \t\t})\r\n");
      out.write("        ]\r\n");
      out.write("    });\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("    var fViewPanel = new Ext.Panel({\r\n");
      out.write("        border : false,\r\n");
      out.write("\t\ttbar : buttons,\r\n");
      out.write("\t\tautoScroll : true,\r\n");
      out.write("\t\titems : dataView,\r\n");
      out.write("\t\tbbar:pagebar\r\n");
      out.write("    });\r\n");
      out.write("\r\n");
      out.write("\t// 视图刷新\r\n");
      out.write("\tpanel.refresh = function(params){\r\n");
      out.write("\t\tif(Ext.isDefined(params)){\r\n");
      out.write("\t\t\tpanel.params = params;\r\n");
      out.write("\t\t\tif (params.topicId) {\r\n");
      out.write("\t\t\t\tAppForumDirect.getTopicForumInfo(params.topicId, function(result, e) {\r\n");
      out.write("\t\t\t\t\tif (result && result.success) {\r\n");
      out.write("\t\t\t\t\t\tcatagoryText.setText('<a href=\"#\" onclick=\"Ext.getCmp(\\'");
      out.print(panelid);
      out.write("\\').openCotagery(' + result.catelogId + ')\">' + result.catelogTitle + '</a> ');\r\n");
      out.write("\t\t\t\t\t\tsubjectText.setText('<a href=\"#\" onclick=\"Ext.getCmp(\\'");
      out.print(panelid);
      out.write("\\').openSubject(' + result.forumId + ')\">' + result.forumTitle + '</a> ');\r\n");
      out.write("\t\t\t\t\t}\r\n");
      out.write("\t\t\t\t});\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\t// 初始化参数\r\n");
      out.write("\t\tstore.baseParams.topicId = panel.params.topicId;\r\n");
      out.write("\t\tstore.baseParams.state = panel.params.state;\r\n");
      out.write("\t\t//store.reload();\r\n");
      out.write("\t\tpagebar.moveFirst();\r\n");
      out.write("\r\n");
      out.write("\t\tpanel.setTitle(Ext.util.Format.ellipsis(panel.params.topicTitle, 15));\r\n");
      out.write("\t}\r\n");
      out.write("\r\n");
      out.write("\t/**按钮逻辑*/\r\n");
      out.write("\t// 发起话题\r\n");
      out.write("\tpanel.createSubject = function() {\r\n");
      out.write("\t\tMixkyApp.desktop.openDocument('mkForum.docSubject', 0, {F_FORUM_ID:panel.initParams.forumId, F_REPLY_SUBJECT_ID:0, F_REMOTE_HOST:\"");
      out.print(clientIp);
      out.write("\"});\r\n");
      out.write("\t}\r\n");
      out.write("\r\n");
      out.write("\t// 回复话题\r\n");
      out.write("\tpanel.replySubject = function() {\r\n");
      out.write("\t\tvar id = panel.params.topicId;\r\n");
      out.write("\t\tvar title = \"回复: \" + panel.params.topicTitle;\r\n");
      out.write("\t\tMixkyApp.desktop.openDocument('mkForum.docReSubject', 0, {F_FORUM_ID:panel.initParams.forumId, F_REPLY_SUBJECT_ID:id, F_TITLE:title, F_REMOTE_HOST:\"");
      out.print(clientIp);
      out.write("\"});\r\n");
      out.write("\t}\r\n");
      out.write("\r\n");
      out.write("\tpanel.topSubject = function(toped) {\r\n");
      out.write("\t\tAppForumDirect.topSubject(panel.params.topicId + \"\", toped);\r\n");
      out.write("\t}\r\n");
      out.write("\r\n");
      out.write("\tpanel.favouriteSubject = function(favourited) {\r\n");
      out.write("\t\tAppForumDirect.favouriteSubject(panel.params.topicId + \"\", favourited);\r\n");
      out.write("\t}\r\n");
      out.write("\r\n");
      out.write("\tpanel.openClosedSubject = function() {\r\n");
      out.write("\t\tAppForumDirect.openSubject(panel.params.topicId + \"\");\r\n");
      out.write("\t}\r\n");
      out.write("\r\n");
      out.write("\tpanel.closeSubject = function() {\r\n");
      out.write("\t\tAppForumDirect.closeSubject(panel.params.topicId + \"\");\r\n");
      out.write("\t}\r\n");
      out.write("\r\n");
      out.write("\tpanel.openReply = function() {\r\n");
      out.write("\t\tvar record = grid.getSelectionModel().getSelected();\r\n");
      out.write("\t\tAppForumDirect.openSubject(record.get(\"ID\"));\r\n");
      out.write("\t}\r\n");
      out.write("\r\n");
      out.write("\tpanel.closeReply = function() {\r\n");
      out.write("\t\tvar record = grid.getSelectionModel().getSelected();\r\n");
      out.write("\t\tAppForumDirect.closeSubject(record.get(\"ID\"));\r\n");
      out.write("\t}\r\n");
      out.write("\r\n");
      out.write("\tpanel.downloadFile = function(id) {\r\n");
      out.write("\t\tlocation.href = \"engine/file/sysdownload.do?id=\" + id + \"&documentdbtype=none&fieldname=F_FILES&documentkey=mkForum.docSubject\";\r\n");
      out.write("\t}\r\n");
      out.write("\r\n");
      out.write("\tpanel.openAll = function() {\r\n");
      out.write("\t\tvar modulePanel = MixkyApp.desktop.openModule('mkForum');\r\n");
      out.write("\t\tvar urlPanel  = modulePanel.openView('mkForum.qForum.vForum');\r\n");
      out.write("\t\tif(urlPanel){\r\n");
      out.write("\t\t\tif(urlPanel.refresh){\r\n");
      out.write("\t\t\t\turlPanel.refresh.defer(50, urlPanel,[{}]);\r\n");
      out.write("\t\t\t}else{\r\n");
      out.write("\t\t\t\turlPanel.initParams = {};\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t}\r\n");
      out.write("\t}\r\n");
      out.write("\r\n");
      out.write("\tpanel.openCotagery = function(id) {\r\n");
      out.write("\t\tvar modulePanel = MixkyApp.desktop.openModule('mkForum');\r\n");
      out.write("\t\tvar urlPanel  = modulePanel.openView('mkForum.qForum.vForum');\r\n");
      out.write("\t\tif(urlPanel){\r\n");
      out.write("\t\t\tif(urlPanel.refresh){\r\n");
      out.write("\t\t\t\turlPanel.refresh.defer(50, urlPanel,[{categoryId:parseInt(id)}]);\r\n");
      out.write("\t\t\t}else{\r\n");
      out.write("\t\t\t\turlPanel.initParams = {categoryId:id};\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t}\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\tpanel.openSubject = function(id) {\r\n");
      out.write("\t\tvar modulePanel = MixkyApp.desktop.openModule('mkForum');\r\n");
      out.write("\t\tvar urlPanel  = modulePanel.openView('mkForum.qForum.vForum');\r\n");
      out.write("\t\tif(urlPanel){\r\n");
      out.write("\t\t\tif(urlPanel.refresh){\r\n");
      out.write("\t\t\t\turlPanel.refresh.defer(50, urlPanel,[{forumId:id, F_FORUM_ID:id}]);\r\n");
      out.write("\t\t\t}else{\r\n");
      out.write("\t\t\t\turlPanel.initParams = {forumId:id, F_FORUM_ID:id};\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t}\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 输出附加脚本 begin\r\n");
      out.write("\r\n");
      out.write("\t// 输出附加脚本 end\r\n");
      out.write("\tpanel.add(fViewPanel);\r\n");
      out.write("\tpanel.doLayout();\r\n");
      out.write("\t// 初始化视图数据\r\n");
      out.write("\tpanel.refresh(panel.initParams);\r\n");
      out.write("  \r\n");
      out.write("});\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("</script>");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try { out.clearBuffer(); } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}

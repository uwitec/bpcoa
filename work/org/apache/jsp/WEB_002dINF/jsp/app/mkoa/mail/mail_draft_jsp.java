/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/7.0.34
 * Generated at: 2013-01-24 07:15:20 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.WEB_002dINF.jsp.app.mkoa.mail;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import com.mixky.engine.organization.User;
import com.mixky.system.ContextHolder;

public final class mail_draft_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private javax.el.ExpressionFactory _el_expressionfactory;
  private org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public void _jspInit() {
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=utf-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");

	String panelid = request.getParameter("panelid");
	String id = (request.getParameter("id") == null ||  request.getParameter("id").trim().length() == 0) ? "0" : request.getParameter("id");
	String loadType = request.getParameter("loadType");
	User user = ContextHolder.instance().getUserCertification().getUserInfo(request);

      out.write("\r\n");
      out.write("<script language='javascript'>\r\n");
      out.write("Ext.onReady(function(){\r\n");
      out.write("\tvar panel = Ext.getCmp('");
      out.print(panelid);
      out.write("');\r\n");
      out.write("\tvar contendId = Ext.id();\r\n");
      out.write("\tvar task = new Ext.util.DelayedTask(function(){\r\n");
      out.write("\t\tmailForm.getForm().findField('F_CONTENT').toggleSourceEdit(true);\r\n");
      out.write("\t});\r\n");
      out.write("\tvar mailcontent = '';\r\n");
      out.write("\tDocumentAppDirect.getClobContext('T_MK_APP_MAIL', 'F_CONTENT', ");
      out.print(id);
      out.write(", function(result, e){\r\n");
      out.write("\t\t\r\n");
      out.write("\t\tif(result && result.success){\r\n");
      out.write("\t\t\t/* document.getElementById(\"ggcontent\").value=result.context; */\r\n");
      out.write("\t\t\t/* Ext.MessageBox.alert(\"提示\",result.context);  */\r\n");
      out.write("\t\t\t//htmlEditor.html(result.context);\r\n");
      out.write("\t\t\tmailcontent = result.context;\r\n");
      out.write("\t\t}else{\r\n");
      out.write("\t\t\tMixkyApp.showDirectActionFail(\"获得文本内容失败\", result, e);\r\n");
      out.write("\t\t}\r\n");
      out.write("\t});\r\n");
      out.write("\tvar mailForm = new Ext.form.FormPanel({\r\n");
      out.write("\t\tborder : false,\r\n");
      out.write("\t\t//style : 'margin : 15px',\r\n");
      out.write("\t\tbodyStyle : 'padding:15px;padding-right:25px;',\r\n");
      out.write("\t\tlabelWidth : 70,\r\n");
      out.write("\t\tfileUpload : true,\r\n");
      out.write("\t\tparamOrder : ['id', 'loadType'],\r\n");
      out.write("\t\tbaseParams : {id : ");
      out.print(id);
      out.write(", loadType: '");
      out.print(loadType);
      out.write("'},\r\n");
      out.write("\t\tapi : {\r\n");
      out.write("\t\t\tload : AppMailDirect.loadDraft,\r\n");
      out.write("\t\t\tsubmit : AppMailDirect.submitDraft\r\n");
      out.write("\t\t},\r\n");
      out.write("\t\ttbar : [{\r\n");
      out.write("\t\t\ttext : '发送',\r\n");
      out.write("\t\t\ticonCls : 'icon-app-mkoa-sent',\r\n");
      out.write("\t\t\thandler: function() {\r\n");
      out.write("\t\t\t\tmailForm.getForm().findField('F_BoxType').setValue('发件箱');\r\n");
      out.write("\t            var iframeId = \"kindeditor_");
      out.print(panelid);
      out.write("\";\r\n");
      out.write("\t\t\t\t\r\n");
      out.write("\t\t\t\tvar content = KE.app.getEditor('contentCn'+contendId).html();\r\n");
      out.write("\t\t\t\tmailForm.getForm().findField('F_CONTENT_TEXT').setValue(content);\r\n");
      out.write("\t\t\t\t//alert(content);\r\n");
      out.write("\t\t\t\tmailForm.getForm().findField('F_CONTENT').setValue(content);\r\n");
      out.write("\t\t\t\t//alert(content);\r\n");
      out.write("\t\t\t\t//mailForm.getForm().findField('F_CONTENT_TEXT').setValue(mailForm.getForm().findField('F_CONTENT').getEditorBody().innerText);\r\n");
      out.write("\t\t\t\tmailForm.getForm().submit({\r\n");
      out.write("\t\t\t\t\tsuccess : function(f, a){\r\n");
      out.write("\t\t\t\t\t\tif (a.result.success) {\r\n");
      out.write("\t\t\t\t\t\t\tMixkyApp.showInfoMessage('邮件已发送成功！', '信息提示');\r\n");
      out.write("\t\t\t\t\t\t\tvar tabpanel = panel.findParentByType('tabpanel');\r\n");
      out.write("\t\t\t\t\t\t\ttabpanel.remove(panel);\r\n");
      out.write("\t\t\t\t\t\t} else {\r\n");
      out.write("\t\t\t\t\t\t\tmailForm.getForm().findField('ID').setValue(a.result.data.ID);\r\n");
      out.write("\t\t\t\t\t\t\tMixkyApp.showInfoMessage(a.result.msg, '信息提示');\r\n");
      out.write("\t\t\t\t\t\t}\r\n");
      out.write("\t\t\t\t\t},\r\n");
      out.write("\t\t\t\t\tfailure : function(f, a){\r\n");
      out.write("\t\t\t\t\t\tif (a.failureType == Ext.form.Action.SERVER_INVALID) {\r\n");
      out.write("\t\t\t\t\t\t\tmailForm.getForm().findField('ID').setValue(a.result.data.ID);\r\n");
      out.write("\t\t\t\t\t\t}\r\n");
      out.write("\t\t\t\t\t\t\r\n");
      out.write("\t\t\t\t\t\tMixkyApp.showFormActionFail(f, a);\r\n");
      out.write("\t\t\t\t\t}\r\n");
      out.write("\t\t\t\t});\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t},'-',{\r\n");
      out.write("\t\t\ttext : '存为草稿',\r\n");
      out.write("\t\t\ticonCls : 'icon-sys-save',\r\n");
      out.write("\t\t\thandler : function(){\r\n");
      out.write("\t\t\t\tmailForm.getForm().findField('F_BoxType').setValue('草稿箱');\r\n");
      out.write("\t            var iframeId = \"kindeditor_");
      out.print(panelid);
      out.write("\";\r\n");
      out.write("\t            var content = KE.app.getEditor('contentCn'+contendId).html();\r\n");
      out.write("\t\t\t\tmailForm.getForm().findField('F_CONTENT_TEXT').setValue(content);\r\n");
      out.write("\t\t\t\tmailForm.getForm().findField('F_CONTENT').setValue(content);\r\n");
      out.write("\t\t\t\tmailForm.getForm().submit({\r\n");
      out.write("\t\t\t\t\tsuccess : function(f,a){\r\n");
      out.write("\t\t\t\t\t\tmailForm.getForm().findField('ID').setValue(a.result.data.ID);\r\n");
      out.write("\t\t\t\t\t\tMixkyApp.showInfoMessage('邮件已保存到草稿箱！', '信息提示');\r\n");
      out.write("\t\t\t\t\t},\r\n");
      out.write("\t\t\t\t\tfailure : function(f, a){\r\n");
      out.write("\t\t\t\t\t\tMixkyApp.showFormActionFail(f, a);\r\n");
      out.write("\t\t\t\t\t}\r\n");
      out.write("\t\t\t\t});\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t},'-',{\r\n");
      out.write("\t\t\ttext : '舍弃',\r\n");
      out.write("\t\t\ticonCls : 'icon-sys-delete',\r\n");
      out.write("\t\t\thandler : function(){\r\n");
      out.write("\t\t\t\tvar tabpanel = panel.findParentByType('tabpanel');\r\n");
      out.write("\t\t\t\ttabpanel.remove(panel);\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t},\r\n");
      out.write("\t\t'->'\r\n");
      out.write("\t\t],\r\n");
      out.write("\t\tdefaults : {\r\n");
      out.write("\t\t\tborder : false\r\n");
      out.write("\t\t},\r\n");
      out.write("\t\titems : [{\r\n");
      out.write("\t\t\tfieldLabel : '<A href=#>收件人</A>',\r\n");
      out.write("\t\t\tname : 'TO',\r\n");
      out.write("\t\t\txtype : 'mixkyemailaddress',\r\n");
      out.write("\t\t\tanchor : '100%',\r\n");
      out.write("\t\t\tlistWidth : 300,\r\n");
      out.write("\t\t\tallowBlank: false,\r\n");
      out.write("\t\t\tdirectFn : AppMailDirect.queryEmailAddress,\r\n");
      out.write("\t\t\tlisteners : {\r\n");
      out.write("\t\t\t\t'afterrender' : function(f){\r\n");
      out.write("\t\t\t\t\tf.label.on('click', function(){\r\n");
      out.write("\t\t\t\t\t\tpanel.showAddressBook('TO');\r\n");
      out.write("\t\t\t\t\t\treturn false;\r\n");
      out.write("\t\t\t\t\t})\r\n");
      out.write("\t\t\t\t}\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t},{\r\n");
      out.write("\t\t\tfieldLabel : '',\r\n");
      out.write("\t\t\tbodyStyle : 'padding-left:75px;padding-bottom:5px;',\r\n");
      out.write("\t\t\thtml : '',\r\n");
      out.write("\t\t\tlisteners : {\r\n");
      out.write("\t\t\t\t'afterrender' : function(f){\r\n");
      out.write("\t\t\t\t\tmailForm.ccLink = this.body.createChild({tag:\"a\", href:'#', html:'添加抄送地址', style:'padding-right:20px;'});\r\n");
      out.write("\t\t\t\t\tmailForm.bccLink = this.body.createChild({tag:\"a\", href:'#', html:'添加密送地址'});\r\n");
      out.write("\t\t\t\t\tmailForm.ccLink.on('click',function(){\r\n");
      out.write("\t\t\t\t\t\tmailForm.addCCAddressField();\r\n");
      out.write("\t\t\t\t\t\treturn false;\r\n");
      out.write("\t\t\t\t\t});\r\n");
      out.write("\t\t\t\t\tmailForm.bccLink.on('click',function(){\r\n");
      out.write("\t\t\t\t\t\tmailForm.addBCCAddressField();\r\n");
      out.write("\t\t\t\t\t\treturn false;\r\n");
      out.write("\t\t\t\t\t});\r\n");
      out.write("\t\t\t\t}\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t},{\r\n");
      out.write("\t\t\txtype: 'hidden',\r\n");
      out.write("\t\t\tanchor: '100%',\r\n");
      out.write("\t\t\tname: 'F_ACCOUNT_ID'\r\n");
      out.write("\t\t},{\r\n");
      out.write("\t\t\txtype: 'mixkydisplayfield',\r\n");
      out.write("\t\t\tanchor: '100%',\r\n");
      out.write("\t\t\tname: 'F_ACCOUNT_NAME',\r\n");
      out.write("\t\t\tfieldLabel: '发件人',\r\n");
      out.write("\t\t\teditable: false,\r\n");
      out.write("\t\t\tdisabled:true\r\n");
      out.write("\t\t},{\r\n");
      out.write("\t\t\tfieldLabel : 'ID',\r\n");
      out.write("\t\t\tname : 'ID',\r\n");
      out.write("\t\t\txtype : 'hidden',\r\n");
      out.write("\t\t\tvalue : ");
      out.print(id);
      out.write("\r\n");
      out.write("\t\t},{\r\n");
      out.write("\t\t\tfieldLabel : '存取标签',\r\n");
      out.write("\t\t\tname : 'F_BoxType',\r\n");
      out.write("\t\t\txtype : 'hidden'\r\n");
      out.write("\t\t},{\r\n");
      out.write("\t\t\tfieldLabel : '邮件类型',\r\n");
      out.write("\t\t\tname : 'F_MailType',\r\n");
      out.write("\t\t\txtype : 'hidden',\r\n");
      out.write("\t\t\tvalue: 'html'\r\n");
      out.write("\t\t},{\r\n");
      out.write("\t\t\tfieldLabel : '邮件内容文本',\r\n");
      out.write("\t\t\tname : 'F_CONTENT_TEXT',\r\n");
      out.write("\t\t\txtype : 'hidden',\r\n");
      out.write("\t\t\tvalue: 'text'\r\n");
      out.write("\t\t},{\r\n");
      out.write("\t\t\tfieldLabel : '邮件内容文本',\r\n");
      out.write("\t\t\tname : 'F_CONTENT',\r\n");
      out.write("\t\t\txtype : 'hidden',\r\n");
      out.write("\t\t\tvalue: 'text'\r\n");
      out.write("\t\t},{\r\n");
      out.write("\t\t\tfieldLabel : '邮件内容文本',\r\n");
      out.write("\t\t\tname : 'AttachmentInfos',\r\n");
      out.write("\t\t\txtype : 'hidden',\r\n");
      out.write("\t\t\tvalue: ''\r\n");
      out.write("\t\t},{\r\n");
      out.write("\t\t\tfieldLabel : '标　题',\r\n");
      out.write("\t\t\tanchor : '100%',\r\n");
      out.write("\t\t\tname : 'F_SUBJECT',\r\n");
      out.write("\t\t\tallowBlank: false,\r\n");
      out.write("\t\t\txtype : 'textfield'\r\n");
      out.write("\t\t},{\r\n");
      out.write("\t\t\tfieldLabel : '',\r\n");
      out.write("\t\t\tstyle : 'padding-bottom:25px;',\r\n");
      out.write("\t\t\txtype : 'displayfield',\r\n");
      out.write("\t\t\tname : 'Attachments',\r\n");
      out.write("\t\t\tisFormField : true,\r\n");
      out.write("\t\t\tisMulti : true,\r\n");
      out.write("\t\t\tlisteners : {\r\n");
      out.write("\t\t\t\t'afterrender' : function(f){\r\n");
      out.write("\t\t\t\t\tf.fileCount = 0;\r\n");
      out.write("\t\t\t\t\tf.childrenObjects = [];\r\n");
      out.write("\t\t\t\t\tf.buttonWrap = this.el.createChild({tag:\"div\",style:\"position: absolute;\"});\r\n");
      out.write("\t\t\t\t\tf.button = new Ext.Button({\r\n");
      out.write("\t\t\t            renderTo: f.buttonWrap,\r\n");
      out.write("\t\t\t            text : '添 加 附 件',\r\n");
      out.write("\t\t\t            iconCls : 'icon-sys-attachment'\r\n");
      out.write("\t\t\t        });\r\n");
      out.write("\t\t\t        f.bindFileField = function(fileField){\r\n");
      out.write("\t\t\t\t\t\tfileField.on({\r\n");
      out.write("\t\t\t\t            scope: this,\r\n");
      out.write("\t\t\t\t            mouseenter: function() {\r\n");
      out.write("\t\t\t\t                this.button.addClass(['x-btn-over','x-btn-focus'])\r\n");
      out.write("\t\t\t\t            },\r\n");
      out.write("\t\t\t\t            mouseleave: function(){\r\n");
      out.write("\t\t\t\t                this.button.removeClass(['x-btn-over','x-btn-focus','x-btn-click'])\r\n");
      out.write("\t\t\t\t            },\r\n");
      out.write("\t\t\t\t            mousedown: function(){\r\n");
      out.write("\t\t\t\t                this.button.addClass('x-btn-click')\r\n");
      out.write("\t\t\t\t            },\r\n");
      out.write("\t\t\t\t            mouseup: function(){\r\n");
      out.write("\t\t\t\t                this.button.removeClass(['x-btn-over','x-btn-focus','x-btn-click'])\r\n");
      out.write("\t\t\t\t            },\r\n");
      out.write("\t\t\t\t            change: function(){\r\n");
      out.write("\t\t\t\t                var v = this.fileField.dom.value;\r\n");
      out.write("\t\t\t\t\t\t\t\tthis.addFileDisplay(v, 0, this.fileField);\r\n");
      out.write("\t\t\t\t            }\r\n");
      out.write("\t\t\t\t        }); \r\n");
      out.write("\t\t\t\t    };\r\n");
      out.write("\t\t\t\t    f.addFileDisplay = function(filename, fileId, fileField){\r\n");
      out.write("\t\t\t\t\t    if(fileId > 0){\r\n");
      out.write("\t\t\t\t\t\t\t// 从数据库中装入\r\n");
      out.write("\t\t\t\t\t\t\tvar wrap = this.el.createChild({tag:'div', style:'height: 22px;'});\r\n");
      out.write("\t\t\t\t\t\t\tvar downloadLink = wrap.createChild({tag:\"a\", href:'#', html:filename});\r\n");
      out.write("\t\t\t\t\t\t\twrap.insertHtml('beforeEnd','　');\r\n");
      out.write("\t\t\t\t\t\t\tvar deleteLink = wrap.createChild({tag:\"a\", href:'#', html:'删除'});\r\n");
      out.write("\t\t\t\t\t\t\tdeleteLink.on('click', function(){\r\n");
      out.write("\t\t\t\t\t\t\t\twrap.remove();\r\n");
      out.write("\t\t\t\t\t\t\t\tthis.fileCount--;\r\n");
      out.write("\t\t\t\t\t\t\t\tthis.adjustFieldTop();\r\n");
      out.write("\r\n");
      out.write("\t\t\t\t\t\t\t\tif (mailForm.getForm().findField('AttachmentInfos').getValue().length > 0) {\r\n");
      out.write("\t\t\t\t\t\t\t\t\tvar serverFiles = mailForm.getForm().findField('AttachmentInfos').getValue().split(';');\r\n");
      out.write("\t\t\t\t\t\t\t\t\tvar attInfos = '';\r\n");
      out.write("\t\t\t\t\t\t\t\t\tfor (var i = 0; i < serverFiles.length; i++) {\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\tif (attInfos != '') {\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t\tattInfos = attInfos + ';';\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t}\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\tif (i == fileId - 1) {\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t\tattInfos = attInfos + ' ';\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t} else {\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t\tattInfos = attInfos + serverFiles[i];\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t}\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t\r\n");
      out.write("\t\t\t\t\t\t\t\t\t}\r\n");
      out.write("\t\t\t\t\t\t\t\t\tmailForm.getForm().findField('AttachmentInfos').setValue(attInfos);\r\n");
      out.write("\t\t\t\t\t\t\t\t}\r\n");
      out.write("\t\t\t\t\t\t\t}, this);\r\n");
      out.write("\t\t\t\t\t\t\tthis.fileCount++;\r\n");
      out.write("\t\t\t\t\t\t\tthis.adjustFieldTop();\r\n");
      out.write("\t\t\t\t\t\t\tf.childrenObjects.push(wrap);\r\n");
      out.write("\t\t\t\t\t\t}else{\r\n");
      out.write("\t\t\t\t\t\t\tvar wrap = this.el.createChild({tag:'div', html:filename + \"　\", style:'height: 22px;'});\r\n");
      out.write("\t\t\t\t\t\t\tvar deleteLink = wrap.createChild({tag:\"a\", href:'#', html:'删除'});\r\n");
      out.write("\t\t\t\t\t\t\tdeleteLink.on('click', function(){\r\n");
      out.write("\t\t\t\t\t\t\t\tfileField.remove();\r\n");
      out.write("\t\t\t\t\t\t\t\twrap.remove();\r\n");
      out.write("\t\t\t\t\t\t\t\tthis.fileCount--;\r\n");
      out.write("\t\t\t\t\t\t\t\tthis.adjustFieldTop();\r\n");
      out.write("\t\t\t\t\t\t\t}, this);\r\n");
      out.write("\t\t\t\t\t\t\tf.childrenObjects.push(wrap);\r\n");
      out.write("\t\t\t\t\t\t\tthis.addFileField();\r\n");
      out.write("\t\t\t\t\t\t\tfileField.setDisplayed('none');\r\n");
      out.write("\t\t\t\t\t\t}\r\n");
      out.write("\t\t\t\t\t};\r\n");
      out.write("\t\t\t\t\tf.addFileField = function(){\r\n");
      out.write("\t\t\t\t\t\tthis.fileField = this.el.createChild({\r\n");
      out.write("\t\t\t\t            name: this.name + '-' + this.fileCount,\r\n");
      out.write("\t\t\t\t            style: 'position: absolute;-moz-opacity: 0;filter:alpha(opacity: 0);opacity: 0;z-index: 2; height: 22px;',\r\n");
      out.write("\t\t\t\t            tag: 'input',\r\n");
      out.write("\t\t\t\t            type: 'file',\r\n");
      out.write("\t\t\t\t            size: 1\r\n");
      out.write("\t\t\t\t        });\r\n");
      out.write("\t\t\t\t\t\tmailForm.doLayout();\r\n");
      out.write("\t\t\t\t        this.bindFileField(this.fileField);\r\n");
      out.write("\t\t\t\t\t\tthis.fileCount++;\r\n");
      out.write("\t\t\t\t\t\tthis.adjustFieldTop();\r\n");
      out.write("\t\t\t\t\t\tf.childrenObjects.push(this.fileField);\r\n");
      out.write("\t\t\t\t\t};\r\n");
      out.write("\t\t\t\t\tf.adjustFieldTop = function(){\r\n");
      out.write("\t\t\t\t\t\tvar top = (this.fileCount - 1) * 22;\r\n");
      out.write("\t\t\t\t        this.buttonWrap.setTop(top);\r\n");
      out.write("\t\t\t\t        this.fileField.setTop(top);\r\n");
      out.write("\t\t\t\t\t};\r\n");
      out.write("\t\t\t\t\tf.addFileField();\r\n");
      out.write("\t\t\t\t\tf.setValue = function(v){\r\n");
      out.write("\t\t\t\t\t\tfor(var i=0;i<this.childrenObjects.length;i++){\r\n");
      out.write("\t\t\t\t\t\t\tthis.childrenObjects[i].remove();\r\n");
      out.write("\t\t\t\t\t\t}\r\n");
      out.write("\t\t\t\t\t\tthis.childrenObjects = [];\r\n");
      out.write("\t\t\t\t\t\tthis.fileCount = 0;\r\n");
      out.write("\t\t\t\t\t\tthis.addFileField();\r\n");
      out.write("\t\t\t\t\t\tif(v instanceof Array){\r\n");
      out.write("\t\t\t\t\t\t\tfor(var i=0;i<v.length;i++){\r\n");
      out.write("\t\t\t\t\t\t\t\tthis.addFileDisplay(v[i].filename + ' (' + v[i].filesize + ')', v[i].id);\r\n");
      out.write("\t\t\t\t\t\t\t}\r\n");
      out.write("\t\t\t\t\t\t}\r\n");
      out.write("\t\t\t\t\t}\r\n");
      out.write("\t\t\t\t}\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t},{\r\n");
      out.write("\t\t\tfieldLabel : '正　文',\r\n");
      out.write("\t\t\tanchor : '100% -200',\r\n");
      out.write("\t\t\tautoScroll : false,\r\n");
      out.write("\t\t\tborder : false,\r\n");
      out.write("\t\t\txtype:'textarea',  \r\n");
      out.write("\t\t\tid:'contentCn'+contendId, \r\n");
      out.write("\t\t\twidth:'100', \r\n");
      out.write("\t\t\theight:'11',\t\r\n");
      out.write("\t\t\tlisteners:{\r\n");
      out.write("\t\t\t\t'render':function(){\r\n");
      out.write("\t\t\t\t\tKE.app.init({\r\n");
      out.write("\t\t\t\t\t\trenderTo : \"contentCn\"+contendId,\r\n");
      out.write("\t\t\t\t\t\tdelayTime : 5,\r\n");
      out.write("\t\t\t\t\t\twidth : '100%',\r\n");
      out.write("\t\t\t\t\t\tallowFileManager : true,\r\n");
      out.write("\t\t\t\t\t\tfullscreenMode : false,\r\n");
      out.write("\t\t\t\t\t\tuploadJson : 'plugin/kd/uoload.do',\r\n");
      out.write("\t\t\t\t\t\tfileManagerJson : 'plugin/kd/filemgr.do',\r\n");
      out.write("\t\t\t\t\t\tallowFileManager : true,\r\n");
      out.write("\t\t\t\t\t\treadonlyMode : false,\r\n");
      out.write("\t\t\t\t\t\tvalue:mailcontent\r\n");
      out.write("\t\t\t\t\t});\r\n");
      out.write("\t\t\t\t}\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t}]\r\n");
      out.write("\t});\r\n");
      out.write("\t\r\n");
      out.write("\t// 添加主送域\r\n");
      out.write("\tmailForm.addCCAddressField = function(){\r\n");
      out.write("\t\tvar field = this.insert(1, {\r\n");
      out.write("\t\t\tfieldLabel : '<A href=#>抄　送</A>',\r\n");
      out.write("\t\t\tname : 'CC',\r\n");
      out.write("\t\t\txtype : 'mixkyemailaddress',\r\n");
      out.write("\t\t\tanchor : '100%',\r\n");
      out.write("\t\t\theight : 50,\r\n");
      out.write("\t\t\tlistWidth : 300,\r\n");
      out.write("\t\t\tdirectFn : AppMailDirect.queryEmailAddress,\r\n");
      out.write("\t\t\tlisteners : {\r\n");
      out.write("\t\t\t\t'afterrender' : function(f){\r\n");
      out.write("\t\t\t\t\tf.label.on('click', function(){\r\n");
      out.write("\t\t\t\t\t\tpanel.showAddressBook('CC');\r\n");
      out.write("\t\t\t\t\t\treturn false;\r\n");
      out.write("\t\t\t\t\t})\r\n");
      out.write("\t\t\t\t}\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t});\r\n");
      out.write("\t\tthis.isShowCCLink = true;\r\n");
      out.write("\t\tthis.ccLink.remove();\r\n");
      out.write("\t\tthis.doLayout();\r\n");
      out.write("\t\treturn field;\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 添加主送域\r\n");
      out.write("\tmailForm.addCCAddressField = function(){\r\n");
      out.write("\t\tvar field = this.insert(1, {\r\n");
      out.write("\t\t\tfieldLabel : '<A href=#>抄　送</A>',\r\n");
      out.write("\t\t\tname : 'CC',\r\n");
      out.write("\t\t\txtype : 'mixkyemailaddress',\r\n");
      out.write("\t\t\tanchor : '100%',\r\n");
      out.write("\t\t\theight : 50,\r\n");
      out.write("\t\t\tlistWidth : 300,\r\n");
      out.write("\t\t\tdirectFn : AppMailDirect.queryEmailAddress,\r\n");
      out.write("\t\t\tlisteners : {\r\n");
      out.write("\t\t\t\t'afterrender' : function(f){\r\n");
      out.write("\t\t\t\t\tf.label.on('click', function(){\r\n");
      out.write("\t\t\t\t\t\tpanel.showAddressBook('CC');\r\n");
      out.write("\t\t\t\t\t\treturn false;\r\n");
      out.write("\t\t\t\t\t})\r\n");
      out.write("\t\t\t\t}\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t});\r\n");
      out.write("\t\tthis.isShowCCLink = true;\r\n");
      out.write("\t\tthis.ccLink.remove();\r\n");
      out.write("\t\tthis.doLayout();\r\n");
      out.write("\t\treturn field;\r\n");
      out.write("\t}\r\n");
      out.write("\t// 添加密送域\r\n");
      out.write("\tmailForm.addBCCAddressField = function(){\r\n");
      out.write("\t\tvar field = this.insert(Ext.isDefined(this.isShowCCLink) ? 2 : 1, {\r\n");
      out.write("\t\t\tfieldLabel : '<A href=#>密　送</A>',\r\n");
      out.write("\t\t\tname : 'BCC',\r\n");
      out.write("\t\t\txtype : 'mixkyemailaddress',\r\n");
      out.write("\t\t\tanchor : '100%',\r\n");
      out.write("\t\t\theight : 50,\r\n");
      out.write("\t\t\tlistWidth : 300,\r\n");
      out.write("\t\t\tdirectFn : AppMailDirect.queryEmailAddress,\r\n");
      out.write("\t\t\tlisteners : {\r\n");
      out.write("\t\t\t\t'afterrender' : function(f){\r\n");
      out.write("\t\t\t\t\tf.label.on('click', function(){\r\n");
      out.write("\t\t\t\t\t\tpanel.showAddressBook('BCC');\r\n");
      out.write("\t\t\t\t\t\treturn false;\r\n");
      out.write("\t\t\t\t\t})\r\n");
      out.write("\t\t\t\t}\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t});\r\n");
      out.write("\t\tthis.bccLink.remove();\r\n");
      out.write("\t\tthis.doLayout();\r\n");
      out.write("\t\treturn field;\r\n");
      out.write("\t}\r\n");
      out.write("\t// 处理装载邮件信息时抄送和密送字段的显示问题\r\n");
      out.write("\tmailForm.getForm().on('actioncomplete', function(form, action){\r\n");
      out.write("\t\tif(action.type == 'directload' && action.result && action.result.success){\r\n");
      out.write("\t\t\tif(Ext.isDefined(action.result.data.CC) && action.result.data.CC != ''){\r\n");
      out.write("\t\t\t\tvar field = form.findField('CC');\r\n");
      out.write("\t\t\t\tif(!field){\r\n");
      out.write("\t\t\t\t\tfield = mailForm.addCCAddressField();\r\n");
      out.write("\t\t\t\t\tfield.setValue(action.result.data.CC);\r\n");
      out.write("\t\t\t\t}\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t\tif(Ext.isDefined(action.result.data.BCC) && action.result.data.BCC != ''){\r\n");
      out.write("\t\t\t\tvar field = form.findField('BCC');\r\n");
      out.write("\t\t\t\tif(!field){\r\n");
      out.write("\t\t\t\t\tfield = mailForm.addBCCAddressField();\r\n");
      out.write("\t\t\t\t\tfield.setValue(action.result.data.BCC);\r\n");
      out.write("\t\t\t\t}\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t\tif(Ext.isDefined(action.result.data.F_CONTENT) && action.result.data.F_CONTENT != ''){\r\n");
      out.write("\t\t\t\t\tKE.app.setValue('contentCn'+contendId,action.result.data.F_CONTENT);\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t}\r\n");
      out.write("\t});\r\n");
      out.write("\r\n");
      out.write("\t// 显示地址簿\r\n");
      out.write("\tpanel.showAddressBook = function(fieldName){\r\n");
      out.write("\t\tvar field = mailForm.getForm().findField(fieldName);\r\n");
      out.write("\t\tif(!Ext.isDefined(field)){return;}\r\n");
      out.write("\t\tvar addressPanel = new Ext.Panel({\r\n");
      out.write("\t\t\tid : 'addressbook',\r\n");
      out.write("\t\t\tlayout : 'fit',\r\n");
      out.write("\t\t\tautoLoad : {\r\n");
      out.write("\t\t\t\turl : 'page.do',\r\n");
      out.write("\t\t\t\tparams : {url:'app/mkoa/mail/mail.addressbook', panelid : 'addressbook'},\r\n");
      out.write("\t\t\t\tloadScripts : true,\r\n");
      out.write("\t\t\t\tscripts\t: true\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t});\r\n");
      out.write("\t\taddressPanel.addressField = field;\r\n");
      out.write("\t\tvar addressBookWin = new Ext.Window({\r\n");
      out.write("\t        modal: true,\r\n");
      out.write("\t        title : '选择邮件地址',\r\n");
      out.write("\t        iconCls : 'icon-app-mkoa-addressbook',\r\n");
      out.write("\t        manager : MixkyApp.desktop.getManager(),\r\n");
      out.write("\t        closeAction : 'hide',\r\n");
      out.write("\t        layout:'fit',\r\n");
      out.write("\t        width: 500,\r\n");
      out.write("\t        height:500,\r\n");
      out.write("\t        maximizable : false,\r\n");
      out.write("\t        minimizable : false,\r\n");
      out.write("\t        resizable: true,\r\n");
      out.write("\t        items : addressPanel,\r\n");
      out.write("\t\t\tbuttons : [{\r\n");
      out.write("\t\t\t\ttext : '确定',\r\n");
      out.write("\t\t\t\ticonCls : 'icon-sys-confirm',\r\n");
      out.write("\t\t\t\thandler : function(){\r\n");
      out.write("\t\t\t\t\tif(Ext.isDefined(addressPanel.confirmSelected)){\r\n");
      out.write("\t\t\t\t\t\taddressPanel.confirmSelected();\r\n");
      out.write("\t\t\t\t\t}\r\n");
      out.write("\t\t\t\t\taddressBookWin.close();\r\n");
      out.write("\t\t\t\t}\r\n");
      out.write("\t\t\t}, {\r\n");
      out.write("\t\t\t\ttext : '取消',\r\n");
      out.write("\t\t\t\ticonCls : 'icon-sys-cancel',\r\n");
      out.write("\t\t\t\thandler : function(){\r\n");
      out.write("\t\t\t\t\taddressBookWin.close();\r\n");
      out.write("\t\t\t\t}\r\n");
      out.write("\t\t\t}]\r\n");
      out.write("\t\t});\r\n");
      out.write("\t\taddressBookWin.show();\r\n");
      out.write("\t}\r\n");
      out.write("\tpanel.add(mailForm);\r\n");
      out.write("\r\n");
      out.write("\tmailForm.getForm().load();\r\n");
      out.write("\t\r\n");
      out.write("\tpanel.doLayout.defer(400, panel);\r\n");
      out.write("\t\r\n");
      out.write("});\r\n");
      out.write("</script>");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try { out.clearBuffer(); } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}

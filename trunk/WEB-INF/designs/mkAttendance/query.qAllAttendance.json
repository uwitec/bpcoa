{
	"f_from":"T_MK_APP_ATTENDANCE_RECORD",
	"f_views":
	{
		"classpath":"view",
		"data":
		[
			{
				"f_url":"framework/engine/view/view.month",
				"f_buttons":
				{
					"classpath":"action",
					"data":
					[
						{
							"f_handler":"function(){\n\tAttendanceAppDirect.getWorkTime(function(result, event) {\n\t\tvar starttime = result.data.F_TIME_START;\n\t\t\n\t\tvar cell = panel.getSelectedCell();\n\t\tvar username = Mixky.app.UserInfo.name;\n\t\tif(Ext.isDefined(store.baseParams.params) && Ext.isDefined(store.baseParams.params.username) && store.baseParams.params.username != ''){\n\t\t\tusername = store.baseParams.params.username;\n\t\t}\n\t\t\n\t\tif(Ext.isDefined(cell)){\n\t\t\tMixkyApp.desktop.openDocument('mkAttendance.docAttendanceRecord',undefined,{F_USER : username, F_DATE : cell.data.date + ' ' + starttime});\n\t\t}else{\n\t\t\tMixkyApp.desktop.openDocument('mkAttendance.docAttendanceRecord',undefined,{F_USER : username});\n\t\t}\n\t\t\n\t});\n}",
							"f_default":false,
							"f_order":1,
							"f_name":"btnAdd",
							"f_caption":"考勤登记",
							"f_key":"btnAdd",
							"f_class":"action",
							"f_i_parent":
							{
								"classpath":"view",
								"data":"mkAttendance.qAllAttendance.vAllAttendances"
							}
						},
						{
							"f_handler":"{\n        file_types: '*.xls;*.xlsx',\n\tupload_url : 'servlet/app/attendance.import',\n\tpost_params : {\n\t\tcolumNumber: 10,\n\t\tuserkey: Mixky.app.UserInfo.login\n\t},\n\tlisteners : {\n\t\t'allUploadsComplete' : function(){\n\t\t\tpanel.refresh();\n\t\t}\n\t}\n}",
							"f_default":false,
							"f_order":3,
							"f_name":"btnImport",
							"f_caption":"导入记录",
							"f_key":"btnImport",
							"f_config":
							{
								"xtype":"mixkyuploadbutton"
							},
							"f_class":"action",
							"f_i_parent":
							{
								"classpath":"view",
								"data":"mkAttendance.qAllAttendance.vAllAttendances"
							}
						},
						{
							"f_icon":"icon-sys-download",
							"f_handler":"function() {\n\tlocation.href='resources/excelmodel/attendance.xls';\n}",
							"f_default":false,
							"f_order":2,
							"f_name":"btnDownloadModel",
							"f_caption":"下载模板",
							"f_key":"btnDownloadModel",
							"f_class":"action",
							"f_i_parent":
							{
								"classpath":"view",
								"data":"mkAttendance.qAllAttendance.vAllAttendances"
							}
						}
					]
				},
				"f_columns":
				{
					"classpath":"column",
					"data":
					[
						{
							"f_type":0,
							"f_order":1,
							"f_query_type":0,
							"f_orderable":false,
							"f_name":"ID",
							"f_caption":"ID",
							"f_key":"ID",
							"f_class":"column",
							"f_i_parent":
							{
								"classpath":"view",
								"data":"mkAttendance.qAllAttendance.vAllAttendances"
							}
						},
						{
							"f_type":1,
							"f_order":3,
							"f_query_type":0,
							"f_orderable":false,
							"f_name":"F_TITLE",
							"f_caption":"F_TITLE",
							"f_key":"F_TITLE",
							"f_class":"column",
							"f_i_parent":
							{
								"classpath":"view",
								"data":"mkAttendance.qAllAttendance.vAllAttendances"
							}
						},
						{
							"f_type":0,
							"f_order":4,
							"f_query_type":0,
							"f_orderable":false,
							"f_name":"F_USER",
							"f_caption":"F_USER",
							"f_key":"F_USER",
							"f_class":"column",
							"f_i_parent":
							{
								"classpath":"view",
								"data":"mkAttendance.qAllAttendance.vAllAttendances"
							}
						},
						{
							"f_type":0,
							"f_order":5,
							"f_query_type":0,
							"f_orderable":false,
							"f_name":"F_SECTION",
							"f_caption":"F_SECTION",
							"f_key":"F_SECTION",
							"f_class":"column",
							"f_i_parent":
							{
								"classpath":"view",
								"data":"mkAttendance.qAllAttendance.vAllAttendances"
							}
						},
						{
							"f_type":0,
							"f_order":6,
							"f_query_type":0,
							"f_orderable":false,
							"f_name":"F_NOTE",
							"f_caption":"F_NOTE",
							"f_key":"F_NOTE",
							"f_class":"column",
							"f_i_parent":
							{
								"classpath":"view",
								"data":"mkAttendance.qAllAttendance.vAllAttendances"
							}
						},
						{
							"f_type":6,
							"f_order":3,
							"f_query_type":0,
							"f_orderable":false,
							"f_name":"F_DATE",
							"f_caption":"F_DATE",
							"f_key":"F_DATE",
							"f_class":"column",
							"f_i_parent":
							{
								"classpath":"view",
								"data":"mkAttendance.qAllAttendance.vAllAttendances"
							}
						},
						{
							"f_type":3,
							"f_order":7,
							"f_query_type":0,
							"f_orderable":false,
							"f_name":"F_TYPE",
							"f_caption":"F_TYPE",
							"f_key":"F_TYPE",
							"f_class":"column",
							"f_i_parent":
							{
								"classpath":"view",
								"data":"mkAttendance.qAllAttendance.vAllAttendances"
							}
						},
						{
							"f_type":0,
							"f_order":8,
							"f_query_type":0,
							"f_orderable":false,
							"f_name":"F_REQUEST_ID",
							"f_caption":"F_REQUEST_ID",
							"f_key":"F_REQUEST_ID",
							"f_class":"column",
							"f_i_parent":
							{
								"classpath":"view",
								"data":"mkAttendance.qAllAttendance.vAllAttendances"
							}
						}
					]
				},
				"f_keycolumn":"ID",
				"f_single_select":false,
				"f_page_size":10,
				"f_isquery":false,
				"f_issummary":false,
				"f_enable_favorite":false,
				"f_parameters":
				{
					"classpath":"viewparameter",
					"data":
					[
						{
							"f_sql":"F_USER = '|value|'",
							"f_nullsql":"F_USER = '|username|'",
							"f_name":"username",
							"f_caption":"vpUser",
							"f_key":"vpUser",
							"f_class":"viewparameter",
							"f_i_parent":
							{
								"classpath":"view",
								"data":"mkAttendance.qAllAttendance.vAllAttendances"
							}
						},
						{
							"f_sql":"MK_GETYM(F_DATE) = '|value|'",
							"f_nullsql":"F_DATE IS NULL",
							"f_name":"F_MONTH",
							"f_caption":"vpMonth",
							"f_key":"vpMonth",
							"f_class":"viewparameter",
							"f_i_parent":
							{
								"classpath":"view",
								"data":"mkAttendance.qAllAttendance.vAllAttendances"
							}
						}
					]
				},
				"f_name":"vAllAttendances",
				"f_caption":"考勤记录",
				"f_key":"vAllAttendances",
				"f_config":
				{
					"params":
					{
						"username":""
					},
					"detailTemplate":"<div class=\"mixky-attendance-detail\" title=\"{0} {1} {2} {3}\"><a href=\"#\" class=\"{4}\" onclick=\"detailHandler({5},\\'{6}\\')\">{0} {1}</a></div>",
					"detailRenderer":"var dt = Date.parseDate(record.get(\"F_DATE\"), 'Y-m-d H:i');\nvar time = dt.format('H:i');\nvar linkcss = 'mixky-link-normal';\nswitch(record.get(\"F_TYPE\")){\ncase 1:\n\tif(dt.format('H:i') > MixkyApp.WorkTimeStart){\n\t\tvar index = store.findBy(function(r, id){\n\t\t\tif(dt.format('Y-m-d') == r.get(\"F_DATE\").substring(0,10) \n\t\t\t\t&& (r.get(\"F_SECTION\") == '全天' || r.get(\"F_SECTION\") == '上午')\n\t\t\t\t&& r.get(\"F_TYPE\") > 2){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t\tif(index == -1){\n\t\t\tlinkcss = 'mixky-link-exception';\n\t\t}\n\t}\n\tbreak;\ncase 2:\n\tif(dt.format('H:i') < MixkyApp.WorkTimeEnd){\n\t\tvar index = store.findBy(function(r, id){\n\t\t\tif(dt.format('Y-m-d') == r.get(\"F_DATE\").substring(0,10) \n\t\t\t\t&& (r.get(\"F_SECTION\") == '全天' || r.get(\"F_SECTION\") == '下午')\n\t\t\t\t&& r.get(\"F_TYPE\") > 2){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t\tif(index == -1){\n\t\t\tlinkcss = 'mixky-link-exception';\n\t\t}\n\t}\n\tbreak;\ncase 0:\n\tlinkcss = 'mixky-link-exception';\ndefault:\n\ttime = record.get(\"F_SECTION\");\n}\nvar type = Mixky.app.common.dictionaryRenderer(record.get(\"F_TYPE\"), 'mkAttendanceType');\nreturn detailTpl.apply([time, type, record.get(\"F_USER\"), record.get(\"F_TITLE\"), linkcss, record.get(\"ID\"), panel.getId()]);",
					"detailHandler":"MixkyApp.desktop.openDocument('mkAttendance.docAttendanceRecord', id);"
				},
				"f_class":"view",
				"f_i_parent":
				{
					"classpath":"query",
					"data":"mkAttendance.qAllAttendance"
				}
			},
			{
				"f_icon":"icon-app-mkoa-autoday",
				"f_url":"app/mkoa/attendance/workday.view",
				"f_buttons":
				{
					"classpath":"action",
					"data":
					[
						{
							"f_icon":"icon-app-mkoa-workday",
							"f_handler":"function(){\n\tvar cell = panel.getSelectedCell();\n\tif(cell && cell.data){\n\t\tAttendanceAppDirect.setWorkDay(cell.data.date, 1, function(result, e){\n\t\t\tif(result && result.success){\n\t\t\t\tcell.data.dayType = 1;\n\t\t\t\tcell.record.set(cell.fieldname, cell.data);\n\t\t\t\tcell.record.commit();\n\t\t\t}else{\n\t\t\t\tMixkyApp.showErrorMessage('设置[' + data.date + ']为工作日失败');\n\t\t\t}\n\t\t});\n\t}\n}",
							"f_default":false,
							"f_order":2,
							"f_name":"btnSetWorkday",
							"f_caption":"设为工作日",
							"f_key":"btnSetWorkday",
							"f_class":"action",
							"f_i_parent":
							{
								"classpath":"view",
								"data":"mkAttendance.qAllAttendance.vWorkDaySetting"
							}
						},
						{
							"f_icon":"icon-app-mkoa-restday",
							"f_handler":"function(){\n\tvar cell = panel.getSelectedCell();\n\tif(cell && cell.data){\n\t\tAttendanceAppDirect.setWorkDay(cell.data.date, 0, function(result, e){\n\t\t\tif(result && result.success){\n\t\t\t\tcell.data.dayType = 0;\n\t\t\t\tcell.record.set(cell.fieldname, cell.data);\n\t\t\t\tcell.record.commit();\n\t\t\t}else{\n\t\t\t\tMixkyApp.showErrorMessage('设置[' + data.date + ']为休息日失败');\n\t\t\t}\n\t\t});\n\t}\n}",
							"f_default":false,
							"f_order":3,
							"f_name":"btnSetRestday",
							"f_caption":"设为休息日",
							"f_key":"btnSetRestday",
							"f_class":"action",
							"f_i_parent":
							{
								"classpath":"view",
								"data":"mkAttendance.qAllAttendance.vWorkDaySetting"
							}
						},
						{
							"f_icon":"icon-app-mkoa-autoday",
							"f_handler":"function(){\n\tExt.MessageBox.confirm('操作提示', '初始化本月工作日设定，覆盖原有设定，您确定吗？', function(btn){\n\t\tif(btn == 'yes'){\n\t\t\tAttendanceAppDirect.initWorkDay(store.baseParams.day, true, function(result, e){\n\t\t\t\tif(result && result.success){\n\t\t\t\t\tstore.reload();\n\t\t\t\t}else{\n\t\t\t\t\tMixkyApp.showErrorMessage('初始化失败');\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t});\n}",
							"f_default":false,
							"f_order":1,
							"f_name":"btnInit",
							"f_caption":"初始化工作日",
							"f_key":"btnInit",
							"f_class":"action",
							"f_i_parent":
							{
								"classpath":"view",
								"data":"mkAttendance.qAllAttendance.vWorkDaySetting"
							}
						}
					]
				},
				"f_single_select":false,
				"f_page_size":0,
				"f_isquery":false,
				"f_issummary":false,
				"f_enable_favorite":false,
				"f_name":"vWorkDaySetting",
				"f_caption":"工作日设定",
				"f_key":"vWorkDaySetting",
				"f_class":"view",
				"f_i_parent":
				{
					"classpath":"query",
					"data":"mkAttendance.qAllAttendance"
				}
			}
		]
	},
	"f_orderby":"F_DATE",
	"f_groups":
	{
		"classpath":"group",
		"data":
		[
			{
				"f_type":6,
				"f_name":"gByUnderUser",
				"f_caption":"gByUnderUser",
				"f_key":"gByUnderUser",
				"f_class":"group",
				"f_i_parent":
				{
					"classpath":"query",
					"data":"mkAttendance.qAllAttendance"
				}
			},
			{
				"f_type":6,
				"f_name":"gByAllUser",
				"f_caption":"gByAllUser",
				"f_key":"gByAllUser",
				"f_class":"group",
				"f_i_parent":
				{
					"classpath":"query",
					"data":"mkAttendance.qAllAttendance"
				}
			}
		]
	},
	"f_name":"qAllAttendance",
	"f_caption":"考勤记录",
	"f_key":"qAllAttendance",
	"f_class":"query",
	"f_i_parent":
	{
		"classpath":"module",
		"data":"mkAttendance"
	}
}